<!-- VISITS OVER TIME CHART -->
<div class="col-md-6 col-sm-6 col-xs-6">
    <div class="x_panel">
        <div class="x_title">
            <div class="col-md-6">
                <h3>Visits Over Time </h3>
            </div>
            <ul class="nav navbar-right panel_toolbox">
                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </li>
                <li><a class="close-link"><i class="fa fa-close"></i></a>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div id="visits-range" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                <input id="visits-date" ng-model="vm.visits_date" ng-change="vm.visits_date_change()" value="vm.visits_date"></input> <b class="caret"></b>
            </div>
            <canvas id="line" class="chart chart-line" chart-data="vm.visits_data" chart-labels="vm.visits_labels" chart-legend="false" chart-series="vm.visits_series" chart-click="">
            </canvas>
        </div>
    </div>
</div>
<!-- END VISITS OVER TIME CHART -->
<!-- NEW USERS CHART -->
<div class="col-md-6 col-sm-6 col-xs-6">
    <div class="x_panel">
        <div class="x_title">
            <div class="col-md-6">
                <h3>New Users</h3>
            </div>
            <ul class="nav navbar-right panel_toolbox">
                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </li>
                <li><a class="close-link"><i class="fa fa-close"></i></a>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div id="new-users-range" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                <input id="new-users-date" ng-model="vm.new_users_date" ng-change="vm.new_users_date_change()" value="vm.new_users_date"></input> <b class="caret"></b>
            </div>
            <canvas id="line" class="chart chart-line" chart-data="vm.new_users_data" chart-labels="vm.new_users_labels" chart-legend="false" chart-series="vm.new_users_series" chart-click="">
            </canvas>
        </div>
    </div>
</div>
<!-- END VISITS OVER TIME CHART -->
<script type="text/javascript">
  // Close ibox function
  $('.close-link').click(function() {
      var content = $(this).closest('div.x_panel');
      content.remove();
  });

  // Collapse ibox function
  $('.collapse-link').click(function() {
      var x_panel = $(this).closest('div.x_panel');
      var button = $(this).find('i');
      var content = x_panel.find('div.x_content');
      content.slideToggle(200);
      (x_panel.hasClass('fixed_height_390') ? x_panel.toggleClass('').toggleClass('fixed_height_390') : '');
      (x_panel.hasClass('fixed_height_320') ? x_panel.toggleClass('').toggleClass('fixed_height_320') : '');
      button.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
      setTimeout(function() {
          x_panel.resize();
      }, 50);
  });

  Chart.defaults.global.legend = {
      enabled: false
  };

  // DATE PICKER SCRIPT //
  $(document).ready(function() {

      var optionSet1 = {
          startDate: moment().subtract(15, 'days'),
          endDate: moment(),
          minDate: '01/01/2012',
          maxDate: moment(),
          dateLimit: {
              days: 60
          },
          showDropdowns: true,
          showWeekNumbers: true,
          timePicker: false,
          timePickerIncrement: 1,
          timePicker12Hour: true,
          ranges: {
              'Today': [moment(), moment()],
              'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
              'Last 7 Days': [moment().subtract(6, 'days'), moment()],
              'Last 30 Days': [moment().subtract(29, 'days'), moment()],
              'This Month': [moment().startOf('month'), moment().endOf('month')],
              'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          },
          opens: 'left',
          buttonClasses: ['btn btn-default'],
          applyClass: 'btn-small btn-primary',
          cancelClass: 'btn-small',
          format: 'MM/DD/YYYY',
          separator: ' to ',
          locale: {
              applyLabel: 'Submit',
              cancelLabel: 'Clear',
              fromLabel: 'From',
              toLabel: 'To',
              customRangeLabel: 'Custom',
              daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
              monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
              firstDay: 1
          }
      };

      var cb = function(start, end, label) {
          $('#visits-range input').val(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
      }

      $('#visits-range input').val(moment().subtract(15, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));
      $('#visits-range').daterangepicker(optionSet1, cb);
      $('#visits-range').on('apply.daterangepicker', function(ev, picker) {
          angular.element(document.getElementById('visits-date')).triggerHandler('change');
      });
      $('#options1').click(function() {
          $('#visits-range').data('daterangepicker').setOptions(optionSet1, cb);
      });
      $('#options2').click(function() {
          $('#visits-range').data('daterangepicker').setOptions(optionSet2, cb);
      });
      $('#destroy').click(function() {
          $('#visits-range').data('daterangepicker').remove();
      });



      var cb2 = function(start, end, label) {
          $('#new-users-range input').val(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
      }

      $('#new-users-range input').val(moment().subtract(15, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));
      $('#new-users-range').daterangepicker(optionSet1, cb2);
      $('#new-users-range').on('apply.daterangepicker', function(ev, picker) {
          angular.element(document.getElementById('new-users-date')).triggerHandler('change');
      });
      $('#options1').click(function() {
          $('#new-users-range').data('daterangepicker').setOptions(optionSet1, cb2);
      });
      $('#options2').click(function() {
          $('#new-users-range').data('daterangepicker').setOptions(optionSet2, cb2);
      });
      $('#destroy').click(function() {
          $('#new-users-range').data('daterangepicker').remove();
      });
  });
</script>
